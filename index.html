<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Element Defender Â· 4ì†ì„± 10ë‹¨ê³„ ë°©ì–´ ê²Œì„</title>
  <meta name="description" content="ë¬¼Â·ë¶ˆÂ·ë‚˜ë¬´Â·ë•… 4ì†ì„±ìœ¼ë¡œ 1~10 ì±•í„°ê¹Œì§€ ì ì  ì–´ë ¤ì›Œì§€ëŠ” ë°©ì–´ ê²Œì„" />
  <style>
    :root{
      --bg:#0b0c0f;
      --fg:#e5e7eb;
      --muted:#9ca3af;
      --line:#1f2937;
      --water:#38bdf8; /* í•˜ëŠ˜ìƒ‰ */
      --fire:#ef4444; /* ë¹¨ê°• */
      --wood:#22c55e; /* ì´ˆë¡ */
      --earth:#facc15; /* ë…¸ë‘ */
    }
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,"Noto Sans KR";background:var(--bg);color:var(--fg);}
    .wrap{max-width:900px;margin:0 auto;padding:20px;text-align:center}
    canvas{background:radial-gradient(circle at center,rgba(255,255,255,.05),transparent 80%);border:1px solid var(--line);border-radius:8px;display:block;margin:0 auto}
    .btn{margin:6px;padding:10px 16px;border:1px solid var(--line);border-radius:8px;background:#111827;color:var(--fg);cursor:pointer;font-weight:600}
    .guide{font-size:24px;font-weight:700;margin-top:16px;color:var(--muted);min-height:32px}
    .footer{color:var(--muted);font-size:13px;margin-top:12px}
  </style>
</head>
<body>
  <div class="wrap">
    <h1>Element Defender ğŸ’§ğŸ”¥ğŸŒ³ğŸª¨</h1>
    <p>ë¬¼ Â· ë¶ˆ Â· ë‚˜ë¬´ Â· ë•… 4ì†ì„±ì„ ì´ìš©í•´ íƒ€ì›Œë¥¼ ì§€ì¼œë¼!<br>ì±•í„° 1ë¶€í„° 10ê¹Œì§€ ì ì  ì–´ë ¤ì›Œì§€ëŠ” ë‚œì´ë„!</p>
    <div class="guide">Q â†’ ğŸ’§ ë¬¼â€ƒâ€ƒW â†’ ğŸ”¥ ë¶ˆâ€ƒâ€ƒE â†’ ğŸŒ³ ë‚˜ë¬´â€ƒâ€ƒR â†’ ğŸª¨ ë•…</div>

    <canvas id="game" width="640" height="480"></canvas>
    <div>
      <button class="btn" id="startBtn">ê²Œì„ ì‹œì‘</button>
      <button class="btn" id="nextBtn" disabled>ë‹¤ìŒ ì±•í„°</button>
      <button class="btn" id="restartBtn">ë‹¤ì‹œí•˜ê¸°</button>
    </div>
    <div class="footer">ë£°: <b>ê°€ìš´ë° ì›</b>ì— ë‹¿ê¸° ì „ì—, <b>ê°™ì€ ì†ì„±(Q/W/E/R)</b>ì„ ëˆŒëŸ¬ <b>ë°©ì–´ ë§</b> ì•ˆì˜ ê°€ì¥ ê°€ê¹Œìš´ íˆ¬ì‚¬ì²´ <b>1ê°œë§Œ</b> ì œê±°í•©ë‹ˆë‹¤. í‹€ë¦¬ê²Œ ëˆ„ë¥´ë©´ HPê°€ ê°ì†Œí•©ë‹ˆë‹¤.</div>
  </div>

  <script>
  ;(()=>{
    const cvs=document.getElementById('game');
    const ctx=cvs.getContext('2d');

    // ì¤‘ì•™/ë°˜ê²½ ì„¤ì •
    const CENTER={x:cvs.width/2,y:cvs.height/2};
    const TOWER_RADIUS=20;           // ê°€ìš´ë° ì›(íƒ€ì›Œ)
    const DEFENSE_RADIUS=120;        // ë°©ì–´ ê°€ëŠ¥ ë§(ì—¬ê¸° ì•ˆìª½ì˜ ê°€ì¥ ê°€ê¹Œìš´ 1ê°œë§Œ ì œê±°)
    const WRONG_PENALTY=5;           // ì˜¤ì…ë ¥ íŒ¨ë„í‹° HP ê°ì†Œ

    // ì†ì„±/ìƒ‰ìƒ(QWER)
    const elements=[
      {key:'water',label:'ë¬¼',color:getComputedStyle(document.documentElement).getPropertyValue('--water').trim(),keyBind:'q'},
      {key:'fire',label:'ë¶ˆ',color:getComputedStyle(document.documentElement).getPropertyValue('--fire').trim(),keyBind:'w'},
      {key:'wood',label:'ë‚˜ë¬´',color:getComputedStyle(document.documentElement).getPropertyValue('--wood').trim(),keyBind:'e'},
      {key:'earth',label:'ë•…',color:getComputedStyle(document.documentElement).getPropertyValue('--earth').trim(),keyBind:'r'}
    ];

    let chapter=1,maxChapter=10,hp=100,projectiles=[],running=false;

    function resetGame(){
      projectiles=[];hp=100;running=false;chapter=1;
      document.getElementById('nextBtn').disabled=true;
      setGuideDefault();
      render();
    }

    function startChapter(){running=true;spawnLoop();}

    function spawnLoop(){
      if(!running) return;
      spawnProjectile();
      // ì±•í„°ë³„ ìŠ¤í° ê°„ê²©(ëŠë¦¬ê²Œ ì‹œì‘í•´ ì ì§„ì  ì¦ê°€)
      const interval=Math.max(1600-120*chapter,900);
      setTimeout(spawnLoop, interval);
    }

    function spawnProjectile(){
      const el=elements[Math.floor(Math.random()*elements.length)];
      const angle=Math.random()*Math.PI*2;
      const radius=Math.max(cvs.width,cvs.height)/2+20;
      const x=CENTER.x+Math.cos(angle)*radius;
      const y=CENTER.y+Math.sin(angle)*radius;
      const speed=0.6+chapter*0.15; // ì±•í„°ë¡œ ì ì§„ ì¦ê°€
      const dx=(CENTER.x-x)/Math.hypot(CENTER.x-x,CENTER.y-y)*speed;
      const dy=(CENTER.y-y)/Math.hypot(CENTER.x-x,CENTER.y-y)*speed;
      projectiles.push({x,y,dx,dy,color:el.color,type:el.key});
    }

    function update(){
      if(!running) return;
      // ì´ë™
      for(const p of projectiles){ p.x+=p.dx; p.y+=p.dy; }
      // íƒ€ì›Œ í”¼ê²© ì²´í¬
      projectiles = projectiles.filter(p=>{
        const dist = Math.hypot(p.x-CENTER.x, p.y-CENTER.y);
        if(dist < TOWER_RADIUS){ hp=Math.max(0, hp-10); return false; }
        return true;
      });
      if(hp<=0){ running=false; document.getElementById('nextBtn').disabled=false; setGuideMsg('ê²Œì„ì˜¤ë²„ - Spaceë¡œ ì¬ì‹œì‘'); }
    }

    function render(){
      ctx.clearRect(0,0,cvs.width,cvs.height);
      // ë°©ì–´ ë§(ê°€ì´ë“œ)
      ctx.save();
      ctx.setLineDash([6,8]);
      ctx.strokeStyle='rgba(255,255,255,.18)';
      ctx.lineWidth=2;
      ctx.beginPath(); ctx.arc(CENTER.x, CENTER.y, DEFENSE_RADIUS, 0, Math.PI*2); ctx.stroke();
      ctx.restore();

      // íƒ€ì›Œ(ê°€ìš´ë° ì›)
      ctx.beginPath(); ctx.arc(CENTER.x, CENTER.y, TOWER_RADIUS, 0, Math.PI*2); ctx.fillStyle='#fff'; ctx.fill();

      // íˆ¬ì‚¬ì²´
      for(const p of projectiles){
        ctx.beginPath(); ctx.arc(p.x, p.y, 6, 0, Math.PI*2);
        ctx.fillStyle=p.color; ctx.fill();
      }

      // HUD
      ctx.fillStyle='white'; ctx.font='16px system-ui';
      ctx.fillText(`ì±•í„° ${chapter} / ${maxChapter}`, 20, 20);
      ctx.fillText(`HP: ${hp}`, 20, 40);
    }

    function loop(){ update(); render(); requestAnimationFrame(loop); } loop();

    // === ì…ë ¥: Q/W/E/R ===
    document.addEventListener('keydown', e=>{
      const k=e.key.toLowerCase();
      if(['q','w','e','r'].includes(k)){
        const el=elements.find(el=>el.keyBind===k);
        if(el){ defend(el.key); flashKey(el.label); }
      }
    });

    // ê°™ì€ ì†ì„± 1ê°œë§Œ ì œê±°(ë°©ì–´ ë§ ì•ˆì—ì„œ ê°€ì¥ ê°€ê¹Œìš´ ê²ƒ)
    function defend(type){
      let nearestIdx=-1, nearestDist=Infinity;
      for(let i=0;i<projectiles.length;i++){
        const p=projectiles[i];
        if(p.type!==type) continue;
        const dist=Math.hypot(p.x-CENTER.x, p.y-CENTER.y);
        if(dist> TOWER_RADIUS && dist<= DEFENSE_RADIUS && dist < nearestDist){
          nearestDist=dist; nearestIdx=i;
        }
      }
      if(nearestIdx>=0){
        // ì„±ê³µ: í•´ë‹¹ 1ê°œë§Œ ì œê±°
        projectiles.splice(nearestIdx,1);
        setGuideMsg('ë°©ì–´ ì„±ê³µ!');
      } else {
        // ì‹¤íŒ¨: ì˜¤ì…ë ¥ íŒ¨ë„í‹°
        hp = Math.max(0, hp - WRONG_PENALTY);
        setGuideMsg(`ì˜¤ì…ë ¥ - HP -${WRONG_PENALTY}`);
        if(hp<=0){ running=false; document.getElementById('nextBtn').disabled=false; }
      }
    }

    // ê°€ì´ë“œ ë©”ì‹œì§€ í‘œì‹œ
    function setGuideMsg(msg){
      const g=document.querySelector('.guide');
      g.textContent=msg;
      clearTimeout(setGuideMsg._t);
      setGuideMsg._t=setTimeout(setGuideDefault, 800);
    }
    function setGuideDefault(){
      document.querySelector('.guide').innerHTML='Q â†’ ğŸ’§ ë¬¼â€ƒâ€ƒW â†’ ğŸ”¥ ë¶ˆâ€ƒâ€ƒE â†’ ğŸŒ³ ë‚˜ë¬´â€ƒâ€ƒR â†’ ğŸª¨ ë•…';
    }

    // ë²„íŠ¼ ë°”ì¸ë”©
    document.getElementById('startBtn').onclick=()=>{ running=true; startChapter(); };
    document.getElementById('restartBtn').onclick=()=>{ resetGame(); };
    document.getElementById('nextBtn').onclick=()=>{
      if(chapter<maxChapter){
        chapter++;
        running=true; projectiles=[]; hp=100; startChapter();
        if(chapter===maxChapter) document.getElementById('nextBtn').disabled=true;
      }
    };
  })();
  </script>
</body>
</html>
